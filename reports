import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class reports {

    private static final String URL = "jdbc:mysql://localhost:3306/company_z";
    private static final String USER = "root";
    private static final String PASSWORD = "pALOmo1130";

    public void generateDivisionReport(int month, int year) {
        String sql = """
                    SELECT d.Name AS Division,
                        SUM(p.earnings - p.fed_tax - p.state_tax - p.fed_med - p.fed_SS
                            - p.retire_401k - p.health_care) AS TotalPay
                    FROM payroll p
                    JOIN employee_division ed ON p.empid = ed.empid
                    JOIN division d ON ed.div_ID = d.ID
                    WHERE MONTH(p.pay_date) = ? AND YEAR(p.pay_date) = ?
                    GROUP BY d.Name;
                """;

        try (Connection conn = DriverManager.getConnection(URL, USER, PASSWORD);
                PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setInt(1, month);
            stmt.setInt(2, year);

            ResultSet rs = stmt.executeQuery();
            System.out.println("Total Pay by Division for " + month + "/" + year + ":");
            System.out.println("----------------------------------------");
            while (rs.next()) {
                System.out.printf("%-20s $%.2f%n", rs.getString("Division"), rs.getDouble("TotalPay"));
            }

        } catch (SQLException e) {
            System.out.println("Error generating division report: " + e.getMessage());
        }
    }

    public void generateJobTitleReport(int month, int year, int jobTitleId) {
        String sql = """
                SELECT jt.job_title as job_titles,
                    SUM(p.earnings - p.fed_tax - p.state_tax - p.fed_med - p.fed_SS
                        - p.retire_401k - p.health_care) AS TotalPay
                FROM payroll p
                JOIN employee_job_titles ejt ON p.empid = ejt.empid
                JOIN job_titles jt ON ejt.job_title_id = jt.job_title_id
                WHERE MONTH(p.pay_date) = ? 
                AND YEAR(p.pay_date) = ?
                AND jt.job_title_id = ?
                GROUP BY jt.job_title;
            """;

        try (Connection conn = DriverManager.getConnection(URL, USER, PASSWORD);
            PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setInt(1, month);
            stmt.setInt(2, year);
            stmt.setInt(3, jobTitleId);

            ResultSet rs = stmt.executeQuery();
            System.out.println("Total Pay for Job Title " + jobTitleId + 
                            " for " + month + "/" + year + ":");
            System.out.println("----------------------------------------");
            while (rs.next()) {
                System.out.printf("%-25s $%.2f%n",
                    rs.getString("JobTitle"),
                    rs.getDouble("TotalPay"));
            }

        } catch (SQLException e) {
            System.out.println("Error generating job title report: " + e.getMessage());
        }
    }

    public void generateHireDateReport(String startDate, String endDate) {
        String sql = """
                    SELECT empid, Fname, Lname, HireDate, Salary
                    FROM employees
                    WHERE HireDate BETWEEN ? AND ?
                    ORDER BY HireDate ASC;
                """;

        try (Connection conn = DriverManager.getConnection(URL, USER, PASSWORD);
                PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setString(1, startDate);
            stmt.setString(2, endDate);

            ResultSet rs = stmt.executeQuery();
            System.out.println("Employees hired between " + startDate + " and " + endDate + ":");
            System.out.println("--------------------------------------------------------");
            while (rs.next()) {
                System.out.printf("%d | %s %s | %s | $%.2f%n",
                        rs.getInt("empid"),
                        rs.getString("Fname"),
                        rs.getString("Lname"),
                        rs.getDate("HireDate"),
                        rs.getDouble("Salary"));
            }

        } catch (SQLException e) {
            System.out.println("Error generating hire date report: " + e.getMessage());
        }
    }

    public void generatePayHistory(int empid) {
        String sql = """
                SELECT pay_date, earnings, fed_tax, fed_med, fed_SS,
                    state_tax, retire_401k, health_care
                FROM payroll
                WHERE empid = ?
                ORDER BY pay_date DESC;
            """;

        try (Connection conn = DriverManager.getConnection(URL, USER, PASSWORD);
            PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setInt(1, empid);

            ResultSet rs = stmt.executeQuery();
            System.out.println("Pay Statement History for Employee ID: " + empid);
            System.out.println("------------------------------------------------------");

            while (rs.next()) {
                System.out.printf(
                    "Date: %s | Earnings: $%.2f | Federal Tax: $%.2f | Medicare: $%.2f | SS: $%.2f | State Tax: $%.2f | 401k: $%.2f | Health: $%.2f%n",
                    rs.getDate("pay_date"),
                    rs.getDouble("earnings"),
                    rs.getDouble("fed_tax"),
                    rs.getDouble("fed_med"),
                    rs.getDouble("fed_SS"),
                    rs.getDouble("state_tax"),
                    rs.getDouble("retire_401k"),
                    rs.getDouble("health_care")
                );
            }

        } catch (SQLException e) {
            System.out.println("Error generating pay history report: " + e.getMessage());
        }
    }


}
